<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="style/form.css">
    <link href="https://db.onlinewebfonts.com/c/88f10bf18a36407ef36bf30bc25a3618?family=SuisseIntl-Regular" rel="stylesheet">
    <link href="https://db.onlinewebfonts.com/c/653d9381828e9577fb1e417dc047f89d?family=SuisseIntl-SemiBold" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Unbounded:wght@500;600;900&display=swap" rel="stylesheet">
    <title>Form</title>
</head>
<body>

<div class="thank-you" style="display: none;">
    <h2>Спасибо за регистрацию!</h2>
    <p>Ваши данные успешно отправлены. Пожалуйста, проверьте информацию ниже:</p>
    <div id="submittedData"></div>
    <button type="button" id="returnToForm">Вернуться к форме</button>
</div>

<form id="registrationForm" action="" method="post">
    <div class="header">
        <h1>Регистрация</h1>
        <button type="button" class="header__close"><img src="img/close-icon.svg" alt="close"></button>
    </div>
    <div class="inputs">
        <label for="name">*пожалуйста, используйте только буквы в поле "Имя"</label>
        <input type="text" id="name" name="name" placeholder="Имя">
        <label for="site"></label>
        <input type="text" id="site" name="site" placeholder="Сайт компании">
        <label for="phone">*введите корректный телефон (пример: 7 900 000 00 00)</label>
        <input type="text" id="phone" name="phone" placeholder="Телефон">
    </div>
    <button type="submit">Получить код</button>
    <label for="checkbox" class="terms">
        <input type="checkbox" id="checkbox" name="checkbox" class="checkbox">
        <span>
            <img src="img/checkbox.svg" alt="check">
        </span>
        <p>Отправляя сведения через электронную форму, вы даете согласие на обработку персональных данных, в том числе сбор, хранение и передачу третьим лицам представленной вами информации на условиях
            <a target="_blank" href="https://roistat.com/ru/privacy">Политики обработки персональных данных</a>.</p>
    </label>
</form>
<script>
  const form = document.querySelector('form'),
    name = form.querySelector('input[name="name"]'),
    labelName = form.querySelector('label[for="name"]'),
    phone = form.querySelector('input[name="phone"]'),
    labelPhone = form.querySelector('label[for="phone"]'),
    checkbox = form.querySelector('input[name="checkbox"]'),
    terms = form.querySelector('.terms'),
    button = form.querySelector('button[type="submit"]');
  let keyCode;
  let nameValid = false;
  let phoneValid = false;
  let checkboxValid = false;

  button.setAttribute('disabled', 'disabled');

  name.addEventListener('input', () => {
    const inputValue = name.value;
    if (name.value.trim() !== '') {
      button.removeAttribute('disabled')
      nameValid = true;
    } else {
      button.setAttribute('disabled', 'disabled');
      nameValid = false;
    }
    if (/[\d]/.test(inputValue)) {
      labelName.classList.add('error');
      button.setAttribute('disabled', 'disabled');
      name.value = inputValue.replace(/\d/g, '');
    } else {
      labelName.classList.remove('error');
    }
  });

  function mask(event) {
    if (event) {
      keyCode = event.keyCode || event.which;
    }
    const pos = this.selectionStart;

    if (pos < 3) event.preventDefault();

    const matrix = "+7 (___) ___ __ __";
    let i = 0;
    const def = matrix.replace(/\D/g, "");
    const val = this.value.replace(/\D/g, "");
    let new_value = matrix.replace(/[_\d]/g, function (a) {
      return i < val.length ? val.charAt(i++) || def.charAt(i) : a;
    });

    i = new_value.indexOf("_");
    if (i !== -1) {
      i < 5 && (i = 3);
      new_value = new_value.slice(0, i);
    }

    const reg = matrix.substr(0, this.value.length).replace(/_+/g,
      function (a) {
        return "\\d{1," + a.length + "}";
      }).replace(/[+()]/g, "\\$&");
    const regex = new RegExp("^" + reg + "$");

    if (!regex.test(this.value) || this.value.length < 5 || (keyCode && keyCode > 47 && keyCode < 58)) this.value = new_value;

    if (event && event.type === "blur" && this.value.length < 5) this.value = "";
  }
  phone.addEventListener('input', mask);
  phone.addEventListener('focus', mask);
  phone.addEventListener('blur', mask);

  phone.addEventListener('input', () => {
    const phoneValue = phone.value.replace(/\D/g, ''); //
    if (phoneValue.length === 11) {
      labelPhone.classList.remove('error');
      button.removeAttribute('disabled');
      phoneValid = true
    } else {
      labelPhone.classList.add('error');
      button.setAttribute('disabled', 'disabled');
      phoneValid = false
    }
  });

  checkbox.addEventListener('input', () => {
    if (checkbox.checked) {
      terms.classList.remove('error');
      button.removeAttribute('disabled');
      checkboxValid = true
    }
    else {
      terms.classList.add('error');
      button.setAttribute('disabled', 'disabled');
      checkboxValid = false
    }
  });

  form.addEventListener('submit', (event) => {
    event.preventDefault();
    if (phone.value.replace(/\D/g, '').length < 11) {
      event.preventDefault();
      labelPhone.classList.add('error');
      button.setAttribute('disabled', 'disabled');
      phone.focus();
      phoneValid = false
    }
    else {
      labelPhone.classList.remove('error');
      button.removeAttribute('disabled');
      phoneValid = true
    }
    if (!checkbox.checked) {
      event.preventDefault();
      terms.classList.add('error');
      button.setAttribute('disabled', 'disabled');
      checkboxValid = false
    }
    else {
      terms.classList.remove('error');
      checkboxValid = true
    }
    if (nameValid && phoneValid && checkboxValid) {
      button.removeAttribute('disabled');

      // Use AJAX to submit the form data to action.php
      const formData = new FormData(form);
      fetch('action.php', {
        method: 'POST',
        body: formData,
      })
        .then(response => response.json())
        .then(data => {
          // Handle the response from action.php if needed
          console.log(data);

          // Disable the form and show the thank you block
          form.style.display = 'none';
          const thankYouBlock = document.querySelector('.thank-you');
          thankYouBlock.style.display = 'block';

          // Display submitted data in the "thank you" block
          const submittedData = document.getElementById('submittedData');
          submittedData.innerHTML = `
                    <p><strong>Имя:</strong> ${name.value}</p>
                    <p><strong>Сайт компании:</strong> ${site.value}</p>
                    <p><strong>Телефон:</strong> ${phone.value}</p>
                `;
        })
        .catch(error => {
          console.error('Error:', error);
        });
    }

  });

  document.getElementById('returnToForm').addEventListener('click', () => {
    // Hide the thank you block and show the form again
    document.querySelector('.thank-you').style.display = 'none';
    form.style.display = 'block';
  });
</script>
</body>
</html>
